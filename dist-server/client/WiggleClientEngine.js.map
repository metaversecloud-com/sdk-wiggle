{"version":3,"file":"WiggleClientEngine.js","names":["_lanceTopia","require","_WiggleRenderer","_interopRequireDefault","obj","__esModule","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","_toPropertyKey","key","_createClass","protoProps","staticProps","prototype","arg","_toPrimitive","_typeof","String","input","hint","prim","Symbol","toPrimitive","undefined","res","call","Number","_get","Reflect","get","bind","property","receiver","base","_superPropBase","desc","getOwnPropertyDescriptor","arguments","value","apply","object","hasOwnProperty","_getPrototypeOf","_inherits","subClass","superClass","create","constructor","_setPrototypeOf","o","p","setPrototypeOf","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","result","NewTarget","construct","_possibleConstructorReturn","self","_assertThisInitialized","ReferenceError","sham","Proxy","Boolean","valueOf","e","getPrototypeOf","WiggleClientEngine","_ClientEngine","_super","gameEngine","options","_this","WiggleRenderer","params","URLSearchParams","window","location","search","searchParams","prop","roomName","on","playerId","document","body","classList","add","querySelector","disabled","className","addEventListener","clickEvent","socket","emit","currentTarget","remove","mouseX","mouseY","updateMouseXY","sendMouseAngle","preventDefault","touches","item","pageX","pageY","player","world","queryObject","clientWidth","zoom","clientHeight","dx","position","y","dy","x","Math","sqrt","sendInput","directionStop","movement","angle","atan2","connect","_this2","then","console","log","message","innerHTML","ClientEngine","exports"],"sources":["../../src/client/WiggleClientEngine.js"],"sourcesContent":["import { ClientEngine } from \"@rtsdk/lance-topia\";\nimport WiggleRenderer from \"../client/WiggleRenderer\";\n\nexport default class WiggleClientEngine extends ClientEngine {\n  constructor(gameEngine, options) {\n    super(gameEngine, options, WiggleRenderer);\n\n    const params = new Proxy(new URLSearchParams(window.location.search), {\n      get: (searchParams, prop) => searchParams.get(prop),\n    });\n    this.roomName = params[\"assetId\"];\n\n    // show try-again button\n    gameEngine.on(\"objectDestroyed\", (obj) => {\n      if (obj.playerId === gameEngine.playerId) {\n        document.body.classList.add(\"lostGame\");\n        document.querySelector(\"#tryAgain\").disabled = false;\n        document.querySelector(\"#tryAgain\").className = \"show\";\n      }\n    });\n\n    // restart game\n    document.querySelector(\"#tryAgain\").addEventListener(\"click\", (clickEvent) => {\n      this.socket.emit(\"requestRestart\");\n      clickEvent.currentTarget.disabled = true;\n      document.querySelector(\"#tryAgain\").className = \"hidden\";\n      document.body.classList.remove(\"lostGame\");\n    });\n\n    this.mouseX = null;\n    this.mouseY = null;\n\n    document.addEventListener(\"mousemove\", this.updateMouseXY.bind(this), false);\n    document.addEventListener(\"mouseenter\", this.updateMouseXY.bind(this), false);\n    document.addEventListener(\"touchmove\", this.updateMouseXY.bind(this), false);\n    document.addEventListener(\"touchenter\", this.updateMouseXY.bind(this), false);\n    this.gameEngine.on(\"client__preStep\", this.sendMouseAngle.bind(this));\n  }\n\n  updateMouseXY(e) {\n    e.preventDefault();\n    if (e.touches) e = e.touches.item(0);\n    this.mouseX = e.pageX;\n    this.mouseY = e.pageY;\n  }\n\n  sendMouseAngle() {\n    let player = this.gameEngine.world.queryObject({ playerId: this.gameEngine.playerId });\n    if (this.mouseY === null || player === null) return;\n\n    let mouseX = (this.mouseX - document.body.clientWidth / 2) / this.zoom;\n    let mouseY = (this.mouseY - document.body.clientHeight / 2) / this.zoom;\n    let dx = mouseY - player.position.y;\n    let dy = mouseX - player.position.x;\n    if (Math.sqrt(dx * dx + dy * dy) < 0.5) {\n      this.sendInput(this.gameEngine.directionStop, { movement: true });\n      return;\n    }\n\n    let angle = Math.atan2(dx, dy);\n    this.sendInput(angle, { movement: true });\n  }\n\n  connect() {\n    return super.connect().then(() => {\n      this.socket.on(\"spectating\", () => {\n        console.log(\"spectating\");\n        document.querySelector(\"#spectating\").className = \"show\";\n      });\n\n      this.socket.on(\"notinroom\", () => {\n        console.log(\"notinroom\");\n      });\n\n      this.socket.on(\"inzone\", () => {\n        document.querySelector(\"#spectating\").className = \"hidden\";\n        document.querySelector(\"#joinGame\").className = \"show\";\n        document.querySelector(\"#joinGame\").addEventListener(\"click\", (clickEvent) => {\n          this.socket.emit(\"requestRestart\");\n          document.querySelector(\"#joinGame\").className = \"hidden\";\n          document.querySelector(\"#instructions\").className = \"hidden\";\n          clickEvent.currentTarget.disabled = true;\n        });\n      });\n\n      this.socket.on(\"error\", (e) => {\n        console.log(\"error\", e);\n        if (e?.message) document.querySelector(\"#error\").innerHTML = e.message;\n      });\n\n      this.socket.on(\"connection_error\", (e) => {\n        console.log(\"Socket connection error\", e);\n      });\n\n      this.socket.on(\"disconnect\", (e) => {\n        console.log(\"disconnected\");\n        document.body.classList.add(\"disconnected\");\n        document.body.classList.remove(\"gameActive\");\n      });\n    });\n  }\n}\n"],"mappings":"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"}